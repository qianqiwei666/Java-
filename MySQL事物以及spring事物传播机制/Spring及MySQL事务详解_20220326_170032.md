# 一、MySQL事务

## 一、MySQL的DDL语句、DML语句与DCL语句

### DDL

> 对库,表,列等,进行create,drop,alter

### DML

> 用于对数据增删改查

### DCL

> 这些语句定义了数据库、表、字段、用户的访问权限和安全级别。主要的语句关键字包括 grant、revoke 等。



## 二、数据库事务

#### 一、数据库引擎对事务支持

> 只有innoDB对事务进行了支持

#### 二、什么是事务

##### 1、事务基本概述

> 一组逻辑操作单元,使数据从一种形态变换到另一种形态

##### 2、事务详解

> 所有的事务操作都是以一个单元来进行执行的,即使出现了故障,也不能改变这种方式,当事务被commit的时候,数据就会被存储起来。如果事务执行途中出现了错误,或者放弃执行,就会rollback。

#### 四、事务ACID(事务的四大特征)

##### 1、原子性

> 指的是事务要么成功,要么失败，没有中间状态。

##### 2、一致性

> 1. 简单阐述:一般指一个数据在事务前后,数据从一个合法的状态转化为另一个合法的状态。
> 2. 什么是合法的状态: 指的是你对这个数据进行的约束。如果越过这个约束,就变得不合法了。
> 3. 举个例子:A有100元,B有300元,当A向B转账200元,这时候A有-100元,B有500元,当你设定A不能少于100元(约束)，这时候就导致了数据的不一致。

##### 3、隔离性

> 事务的执行不能被其他事务干扰。就是说对并发执行的事务互不干扰。

##### 4、持久性

> 数据提交过后,数据持久化到磁盘中。

#### 五、隐式事务与显示事务

##### 1、显示事务

> 手动开启一个事务: start transaction 或者begin 
>
> start transaction后面可以跟 read only/read write(默认)

##### 2、隐式事务

> MySQL默认将自动提交开启(autocommit)
>
> 关闭(autocommit):set  autocommit =false;
>
> 查看(autocommit):show variables like 'autocommit';

##### 3、总结

> 1. 开启autocommit MySQL自动帮你提交。
> 2. 事务之间开启一个新的事务，当前事务就会自动提交。
> 3. 开启autocommit之后如果再启动事务,MySQL不会帮你自动提交。

#### 六、事务的并发问题

##### 1、脏读

> 开启事务A,事务B,当A事务读取到B事务未提交的数据的时候,就产生了脏读的现象。

##### 2、不可重复读

> 开启事务A,事务B,当事务A读取了一个字段，然后事务B修改了当前的字段,之后事务A再次读取当前字段的时候,跟原来字段不一样,就造成了不可重复读。

##### 3、幻读

> 分别开启事务A,事务B,当事务A读取了当前数据,之后事务B新增了一条数据,当事务B再次读取的时候,就会多出一条数据,这时候就出现了幻读。幻读适用于增加一条数据,并非删除一条数据。那么当A事务读取数据的时候发现数据变少了(B事务删除了一条数据),归类于不可重复读。

#### 七、MySQL四种隔离级别

##### 一、读未提交(read uncommit)

> 所有的事务都可以查看到其他事务为提交的结果。但是脏读,不可重复读,幻读的问题依然存在

##### 二、读已提交(read commit)

> 一个事务只能查看到其他事务已经提交的结果,解决了脏读的问题,但是不可重复读,幻读的问题依旧存在。

##### 三、可重复读(repeatable read)

> A事务读取了数据,之后B事务更改了当前数据并且进行了提交,当A事务再次读取这个数据的时候,读取的数据还是B事务修改之前的数据。解决了脏读，不可重复读,但是没解决幻读。

##### 四、可串行化(serializable)

> 解决了所有的问题,但是执行效率太慢。

# 二、Spring事务

## 一、Spring事务传播行为

#### 一、什么是事务方法

> 对数据库表进行变化的方法,称之为事务方法。

#### 二、事务传播行为

##### 1、required

> 当前方法A有事务,调用方法B的时候,B方法就使用A事务。
>
> 当前方法A没有事务,调用方法B的时候,A方法就会开启一个新的事务。

##### 1、required_new

> 当前方法A无论是否有事务,调用方法B的时候,都会开启一个新的事务。
